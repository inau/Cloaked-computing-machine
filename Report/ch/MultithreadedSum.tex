\chapter{Multithreaded Sum}

\section{Requirements}

\begin{itemize}
\item Calculate the sum of the roots of numbers 0..N
\item Use multiple threads to do so
\end{itemize}

\section{Solution}
we have used a code snippet from our course book (Operating System Concepts 9th edition P. 171), which we based our solution on.\\

The major alteration is in the form of us adding a struct to contain information about each process' 'workload'. Then we pass them in as the runners argument and can access them from the processes.\\

\section{Alternatives}
Another solution could be to have every thread update the same counter. Memory wise we would not be forced to allocate space for every 'counter' but in regards to multiple processes reading and writing to the same resource the memory preservation would be a trade off for possible concurrency issues or waiting threads - which in the end might reduce performance.

\section{Relevant code from sqrt.c}
\subsection{Workload Struct}
The idea is to provide the worker threads with a structure that describes the work to be done on the given thread and a place to store the given workers results.

\lstinputlisting[xleftmargin=40.0px, language=C,numbers=left,linerange={10-14}, firstnumber=10]{code/sqrt.c}

\subsection{Runnable code}
The tricky part here was actually doing the cast, once that is done everything works smoothly.


\lstinputlisting[xleftmargin=40.0px, language=C,numbers=left,linerange={94-110}, firstnumber=94]{code/sqrt.c}

\section{Testing}

\definecolor{gr1}{gray}{0.65}
\definecolor{gr2}{gray}{0.85}


\newcommand{\rowhead}[1] {
\multicolumn{2}{l}{#1}\\
\hline
}

\newcommand{\row}[3] {
\hline
\rowcolor{gr1}
Inputs&\\
\hline \hline
\rowcolor{gr2}
Calculations: & #1 \\
\hline
\rowcolor{gr2}
Threads: & #2 \\
\hline
\rowcolor{gr2}
Time: & #3 \\
\hline \hline
}

\newcommand{\botrow}[3] {
\hline
\rowcolor{gr1}
Inputs&\\
\hline \hline
\rowcolor{gr2}
N = & #1 \\
\hline
\rowcolor{gr2}
Threads: & #2 \\
\hline
\rowcolor{gr2}
Time: & #3 \\
\hline
}

\begin{table}[ht]
\begin{tabular}{| p{\dimexpr.2\textwidth} | p{\dimexpr.5\textwidth-4\tabcolsep} |}
\rowhead{Results}
\row{100 000 000 000}{1}{8 seconds}
\row{100 000 000 000}{2}{5 seconds}
\row{100 000 000 000}{4}{4 seconds}
\row{100 000 000 000}{8}{3 seconds}
\end{tabular}
\end{table}